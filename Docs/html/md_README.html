<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LEM_GDML_UPGRADE: Low Energy Module (LEM): Upgrade with geometry from CAD file</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LEM_GDML_UPGRADE
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">LEM-G4</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Low Energy Module (LEM): Upgrade with geometry from CAD file </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="./docs/LEM_logo.PNG" alt="" width="20%" height="20%" class="inline"/> <img src="./docs/G4Logo.png" alt="" width="50%" height="50%" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Brief description</h1>
<p>This repository contains the source code for the Geant4 simulation of the Low Energy Module, a submodule fo the Zire` detector onboard teh NUSES platform.</p>
<p><img src="./docs/LEM.png" alt="" width="80%" class="inline"/></p>
<p>This simulation is inherited by the Geant4 example <b>G04</b> <a href="https://gitlab.cern.ch/geant4/geant4/-/tree/v11.1.1/examples/extended/persistency/gdml/G04">Link to the G04 example</a>.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Softwares adopted</h1>
<p>Here the list of softwares and tools I used for the realisation of this repository:</p><ol type="1">
<li>Fusion 360 by AutoDesk for the implementation of a plausible geometry of the LEM <img src="https://www.dsi-mfg.com/hubfs/Logos/Autodesk/Fusion-360-2023-lockup-Blk-OL-ADSK-No-Year-Stacked.png" alt="" width="30%" height="20%" class="inline"/></li>
<li>The geometry was then exported into a .step file. To open the .step file and for the generation of the GDML file I used FreeCAD</li>
</ol>
<p><img src=" https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/FreeCAD-logo.svg/1200px-FreeCAD-logo.svg.png " alt="" width="10%" height="10%" class="inline"/></p>
<ol type="1">
<li>The FreeCAD workbench was then used for the assignment of the materials to all of the volumes within the geometry. It can be installed via the <b>Addon Manager</b>. See the linked repository on Github <a href="https://github.com/KeithSloan/GDML">https://github.com/KeithSloan/GDML</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
Link and resources</h1>
<ul>
<li>Geant4 website <a href="https://geant4.web.cern.ch/">https://geant4.web.cern.ch/</a></li>
<li>Geant4 example G04 repository GitLab <a href="https://gitlab.cern.ch/geant4/geant4/-/tree/v11.1.1/examples/extended/persistency/gdml/G04">https://gitlab.cern.ch/geant4/geant4/-/tree/v11.1.1/examples/extended/persistency/gdml/G04</a></li>
<li>GDML Documentation <a href="https://gdml.web.cern.ch/GDML/">https://gdml.web.cern.ch/GDML/</a></li>
<li>FreeCAD website <a href="https://www.freecad.org/">https://www.freecad.org/</a></li>
<li>FreeCAD GDML workbench <a href="https://github.com/KeithSloan/GDML">https://github.com/KeithSloan/GDML</a></li>
<li>Fusion 360 software <a href="https://www.autodesk.it/">https://www.autodesk.it/</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
FreeCAD GDML Workbench commands</h1>
<p>Here some useful commands for the utilization of the FreeCAD Python console with the GDML workbench</p><ul>
<li>&lsquo; FreeCAD.getDocument('Unnamed&rsquo;).getObject('GDMLBox_WorldBox').material = u"G4_Galactic"<code>: Assegnazione del materiale G4_Galactic al volume worldVol -</code>Gui.activateWorkbench("GDML_Workbench")` : Command for the activation of the Workbench GDML</li>
</ul>
<ol type="1">
<li>&lsquo;Gui.runCommand('BoxCommand&rsquo;,0)<code>: Command for the creation of a G4Box for the world volume 2.</code>Gui.Selection.addSelection('Unnamed','LV_Box')<code>: Select the part containing the world volume 3.</code>Gui.Selection.addSelection('Unnamed','LV_Box','GDMLBox_Box.')<code>Select the GDML Box object under the respective part 4.</code>FreeCAD.getDocument('Unnamed').getObject('GDMLBox_Box').material = u"G4_Galactic"<code>: Change the material of the G4Box 5.</code>FreeCAD.getDocument('Unnamed').getObject('LV_Box').Label = "worldVol"<code>: rename the object label 6.</code>Gui.activeView().setActiveObject('part', App.activeDocument().Part)` Generate a part inside the document</li>
<li>Change the link between the parts. Move the created part under the world volume part <div class="fragment"><div class="line">App.getDocument(&#39;Unnamed&#39;).getObject(&#39;Part&#39;).adjustRelativeLinks(App.getDocument(&#39;Unnamed&#39;).getObject(&#39;LV_Box&#39;))</div>
<div class="line"> </div>
<div class="line">App.getDocument(&quot;Unnamed&quot;).getObject(&quot;LV_Box&quot;).addObject(App.getDocument(&quot;Unnamed&quot;).getObject(&quot;Part&quot;))</div>
</div><!-- fragment --></li>
<li>&lsquo;FreeCAD.getDocument('Unnamed&rsquo;).getObject('Part').Label = "LEM_Assembly"` Rename the part under the world volume to "LEM_Assembly". Here we have to put the solids from the step file</li>
</ol>
<h1><a class="anchor" id="autotoc_md5"></a>
Run the simulation</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
With visualization</h2>
<p>For running the simulation with the visualization use the bash script <b>simulationVis.sh</b>. The commands in this script are listed below. The executable file is named <b>gdml_det</b>. It is <b>MANDATORY</b> to give an argument to the executable which is the path to the <b>GDML</b> file containing the description of the detector.</p>
<div class="fragment"><div class="line">cd ./build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
<div class="line">./gdml_det LowEnergyVolume_WorldVolume.gdml</div>
<div class="line">cd ..</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Detector concept</h1>
<p>The detector is designed in the following way. From the external to the internal part there are:</p><ul>
<li>An aluminium mask formin a collimator. The Aluminium layer is 0.8 cm thick</li>
<li>An active Veto made of plastic scintillator EJ-200 1 cm thick</li>
<li>A first Silicon layer $100 \ \mu m$ thick. This is the $\Delta E$ layer in which only a small fraction of the energy is deposited. This amount of energy is sometimes called Linear Energy Transfer (LET). This because <br  />
 $$ \Delta E \approx \biggl| - \frac{1}{\rho} \frac{dE}{dx} \biggr| \rho_{Si} \times \Delta x $$</li>
<li>Then, a second layer made of Silicon with larger thickness is the layer in which the particle has to stop. The simulation has the setting to change this thickness and also to select another option of the material which is the CZT, a denser material.</li>
<li>An active veto, made of plastic scintillator Ej-200 is then positioned on the back. If a particle is too energetic, it reaches the veto which wiull trigger ignoring that event.</li>
<li>Additional plastic scintillator layers are added to extend te observed energy window to higher energies</li>
</ul>
<p>The detector is based on the $\Delta E - E$ technique. This simulation is aimed at characterising the energy deposition inside the materials using the correct geometry of the instrument.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Directory structure</h1>
<p>At the moment, the directory structure is the following</p>
<div class="fragment"><div class="line">.</div>
<div class="line">├── build</div>
<div class="line">│   ├── auxiliary.gdml</div>
<div class="line">│   ├── CMakeCache.txt</div>
<div class="line">│   ├── CMakeFiles</div>
<div class="line">│   │   ├── 3.22.1</div>
<div class="line">│   │   │   ├── CMakeCCompiler.cmake</div>
<div class="line">│   │   │   ├── CMakeCXXCompiler.cmake</div>
<div class="line">│   │   │   ├── CMakeDetermineCompilerABI_C.bin</div>
<div class="line">│   │   │   ├── CMakeDetermineCompilerABI_CXX.bin</div>
<div class="line">│   │   │   ├── CMakeSystem.cmake</div>
<div class="line">│   │   │   ├── CompilerIdC</div>
<div class="line">│   │   │   │   ├── a.out</div>
<div class="line">│   │   │   │   ├── CMakeCCompilerId.c</div>
<div class="line">│   │   │   │   └── tmp</div>
<div class="line">│   │   │   └── CompilerIdCXX</div>
<div class="line">│   │   │       ├── a.out</div>
<div class="line">│   │   │       ├── CMakeCXXCompilerId.cpp</div>
<div class="line">│   │   │       └── tmp</div>
<div class="line">│   │   ├── cmake.check_cache</div>
<div class="line">│   │   ├── CMakeDirectoryInformation.cmake</div>
<div class="line">│   │   ├── CMakeOutput.log</div>
<div class="line">│   │   ├── CMakeRuleHashes.txt</div>
<div class="line">│   │   ├── CMakeTmp</div>
<div class="line">│   │   ├── G04.dir</div>
<div class="line">│   │   │   ├── build.make</div>
<div class="line">│   │   │   ├── cmake_clean.cmake</div>
<div class="line">│   │   │   ├── compiler_depend.make</div>
<div class="line">│   │   │   ├── compiler_depend.ts</div>
<div class="line">│   │   │   ├── DependInfo.cmake</div>
<div class="line">│   │   │   └── progress.make</div>
<div class="line">│   │   ├── gdml_det.dir</div>
<div class="line">│   │   │   ├── build.make</div>
<div class="line">│   │   │   ├── cmake_clean.cmake</div>
<div class="line">│   │   │   ├── compiler_depend.internal</div>
<div class="line">│   │   │   ├── compiler_depend.make</div>
<div class="line">│   │   │   ├── compiler_depend.ts</div>
<div class="line">│   │   │   ├── DependInfo.cmake</div>
<div class="line">│   │   │   ├── depend.make</div>
<div class="line">│   │   │   ├── flags.make</div>
<div class="line">│   │   │   ├── gdml_det.cc.o</div>
<div class="line">│   │   │   ├── gdml_det.cc.o.d</div>
<div class="line">│   │   │   ├── link.txt</div>
<div class="line">│   │   │   ├── progress.make</div>
<div class="line">│   │   │   └── src</div>
<div class="line">│   │   │       ├── G04ActionInitialization.cc.o</div>
<div class="line">│   │   │       ├── G04ActionInitialization.cc.o.d</div>
<div class="line">│   │   │       ├── G04DetectorConstruction.cc.o</div>
<div class="line">│   │   │       ├── G04DetectorConstruction.cc.o.d</div>
<div class="line">│   │   │       ├── G04EventAction.cc.o</div>
<div class="line">│   │   │       ├── G04EventAction.cc.o.d</div>
<div class="line">│   │   │       ├── G04HitClass.cc.o</div>
<div class="line">│   │   │       ├── G04HitClass.cc.o.d</div>
<div class="line">│   │   │       ├── G04PrimaryGeneratorAction.cc.o</div>
<div class="line">│   │   │       ├── G04PrimaryGeneratorAction.cc.o.d</div>
<div class="line">│   │   │       ├── G04RunAction.cc.o</div>
<div class="line">│   │   │       ├── G04RunAction.cc.o.d</div>
<div class="line">│   │   │       ├── G04SensitiveDetector.cc.o</div>
<div class="line">│   │   │       ├── G04SensitiveDetector.cc.o.d</div>
<div class="line">│   │   │       ├── G04TrackingAction.cc.o</div>
<div class="line">│   │   │       └── G04TrackingAction.cc.o.d</div>
<div class="line">│   │   ├── Makefile2</div>
<div class="line">│   │   ├── Makefile.cmake</div>
<div class="line">│   │   ├── progress.marks</div>
<div class="line">│   │   └── TargetDirectories.txt</div>
<div class="line">│   ├── cmake_install.cmake</div>
<div class="line">│   ├── defaultSetting.mac</div>
<div class="line">│   ├── g04.mac</div>
<div class="line">│   ├── G4History.macro</div>
<div class="line">│   ├── gdml_det</div>
<div class="line">│   ├── init_vis.mac</div>
<div class="line">│   ├── LowEnergyVolume_WorldVolume.gdml</div>
<div class="line">│   ├── Makefile</div>
<div class="line">│   └── vis.mac</div>
<div class="line">├── CMakeLists.txt</div>
<div class="line">├── docs</div>
<div class="line">│   ├── G4Logo.png</div>
<div class="line">│   └── LEM_logo.PNG</div>
<div class="line">├── gdml_det.cc</div>
<div class="line">├── GdmlFiles</div>
<div class="line">│   ├── auxiliary.gdml</div>
<div class="line">│   └── LowEnergyVolume_WorldVolume.gdml</div>
<div class="line">├── GNUmakefile</div>
<div class="line">├── History</div>
<div class="line">├── include</div>
<div class="line">│   ├── G04ActionInitialization.hh</div>
<div class="line">│   ├── G04DetectorConstruction.hh</div>
<div class="line">│   ├── G04EventAction.hh</div>
<div class="line">│   ├── G04HitClass.hh</div>
<div class="line">│   ├── G04PrimaryGeneratorAction.hh</div>
<div class="line">│   ├── G04RunAction.hh</div>
<div class="line">│   ├── G04SensitiveDetector.hh</div>
<div class="line">│   └── G04TrackingAction.hh</div>
<div class="line">├── macro</div>
<div class="line">│   ├── defaultSetting.mac</div>
<div class="line">│   ├── g04.mac</div>
<div class="line">│   ├── init_vis.mac</div>
<div class="line">│   └── vis.mac</div>
<div class="line">├── OutputText</div>
<div class="line">│   ├── GDML_AuxiliaryInfo.txt</div>
<div class="line">│   ├── GDML_MaterialInfo.txt</div>
<div class="line">│   └── GDML_SolidNames.txt</div>
<div class="line">├── README</div>
<div class="line">├── simulationVis.sh</div>
<div class="line">└── src</div>
<div class="line">    ├── G04ActionInitialization.cc</div>
<div class="line">    ├── G04DetectorConstruction.cc</div>
<div class="line">    ├── G04EventAction.cc</div>
<div class="line">    ├── G04HitClass.cc</div>
<div class="line">    ├── G04PrimaryGeneratorAction.cc</div>
<div class="line">    ├── G04RunAction.cc</div>
<div class="line">    ├── G04SensitiveDetector.cc</div>
<div class="line">    └── G04TrackingAction.cc</div>
<div class="line"> </div>
<div class="line">17 directories, 95 files</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Doxygen documentation</h1>
<p>Doxygen documentation is available in the <code>Docs</code> folder. To generate it, run the following command in the main directory</p>
<div class="fragment"><div class="line">doxygen Doxyfile</div>
</div><!-- fragment --><p> To generate the pdf you need to add to the preamble of the <code>refman.tex</code> file the following line </p><div class="fragment"><div class="line">\usepackage{pmboxdraw}</div>
</div><!-- fragment --><p> This is needed to correctly display the tree structure of the classes. Then run the following commands </p><div class="fragment"><div class="line">make </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
